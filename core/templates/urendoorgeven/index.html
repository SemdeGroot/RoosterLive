{% extends "base.html" %}
{% load static role_tags form_extras %}

{% block title %}Uren doorgeven{% endblock %}
{% block header_title %}Uren doorgeven{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/admin/admin_panel.css' %}">
  <link rel="stylesheet" href="{% static 'css/urendoorgeven/urendoorgeven.css' %}">
  <script src="{% static 'js/urendoorgeven/urendoorgeven.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="admin-wrap">
  <div class="card">
    <div class="card-inner">

      <div class="birthday-header agenda-section-header">
        <img src="{% static 'img/uren_doorgeven.svg' %}" alt="" class="birthday-icon">
        <div class="birthday-header-text">
          <h2>Uren doorgeven</h2>
          <p>
            Geef hier je gewerkte uren door voor de maand <strong>{{ target_month|date:"F Y" }}</strong>.
            Deadline: <strong>{{ deadline_local_str }}</strong>.
          </p>
        </div>
      </div>

      <div class="uren-deadline-bar" style="margin-bottom: 16px;"
           data-deadline="{{ deadline_iso }}"
           data-deadline-passed="{{ deadline_passed|yesno:'1,0' }}">
        <div class="uren-deadline-left">
          <span class="uren-deadline-label">Tijd tot deadline</span>
          <span class="uren-deadline-timer" id="deadlineTimer">â€”</span>
        </div>
        {% if deadline_passed %}
          <span class="badge danger">Deadline voorbij</span>
        {% else %}
          <span class="badge ok">Beschikbaar</span>
        {% endif %}
      </div>


      <div class="uren-grid-top">
        <div class="uren-help-card">
          <div style="margin-top:6px;">
            Vul je totale uren in voor de maand, gesplitst in
            <strong>tot 18:00</strong> en <strong>na 18:00</strong>.
          </div>
        </div>
        <div class="uren-toeslag-card">
          <div class="uren-toeslag-row">
            <div>
              <div class="muted">CAO toeslag na 18:00</div>
              <div class="uren-toeslag-value">
                <span id="toeslagValue">{{ settings_obj.evening_allowance_pct }}%</span>
              </div>
            </div>

            {% if can_edit %}
            <button type="button" class="icon-btn" id="toeslagEditBtn" aria-label="Bewerk toeslag">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                   stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20h9"/>
                <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
              </svg>
            </button>
            {% endif %}
          </div>

       {% if can_edit %}
      <form method="post" id="toeslagForm" class="toeslag-form form" style="display:none;">
        {% csrf_token %}
        <input type="hidden" name="form_kind" value="settings">

        <div class="admin-grid">
          <div>
            <label for="{{ settings_form.evening_allowance_pct.id_for_label }}" class="muted">
              Nieuwe toeslag %
            </label>
            {{ settings_form.evening_allowance_pct }}
          </div>
        </div>

        <div class="actions-wrap horizontal" style="margin-top:6px;">
          <button class="btn btn-save" type="submit">Opslaan</button>
          <button class="btn btn-danger" type="button" id="toeslagCancelBtn">Annuleren</button>
        </div>
      </form>
      {% endif %}

        </div>

      </div>

      <h3 style="margin-top: 20px;">Uren invoeren</h3>

      <form method="post" autocomplete="off" class="uren-form">
        {% csrf_token %}
        <input type="hidden" name="form_kind" value="hours">

        <div class="form form-sticky-actions" style="padding:0;">
          <div class="admin-grid" style="margin-bottom: 12px;">
            <div>
              <label for="{{ uren_form.hours_before_18.id_for_label }}">Uren tot 18:00</label>
              {{ uren_form.hours_before_18 }}
              <div class="hint">Max. 1 decimaal</div>
            </div>

            <div>
              <label for="{{ uren_form.hours_after_18.id_for_label }}">
                Uren na 18:00 <span class="muted">(met toeslag {{ settings_obj.evening_allowance_pct }}%)</span>
              </label>
              {{ uren_form.hours_after_18 }}
              <div class="hint">Max. 1 decimaal</div>
            </div>
          </div>

          {% if deadline_passed %}
          <div class="uren-actions">
            <button class="btn btn-save btn-block" type="submit" disabled style="opacity:.6;">
              Opslaan (deadline voorbij)
            </button>
          </div>
          {% else %}
          <div class="uren-actions">
            <button class="btn btn-save" type="submit" data-haptic>
              Opslaan
            </button>
          </div>
          {% endif %}
        </div>
      </form>

    </div>
  </div>
</div>
{% endblock %}
