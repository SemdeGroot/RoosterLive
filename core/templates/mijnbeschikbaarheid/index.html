{% extends "base.html" %}
{% load static i18n %}

{% block title %}Beschikbaarheid{% endblock %}
{% block header_title %}Beschikbaarheid{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/mijnbeschikbaarheid/mijnbeschikbaarheid.css' %}">
{% endblock %}

{% block content %}
<div class="card">
  <div class="form">
    <h3 style="margin:0 0 8px 0;">Vink hier je beschikbaarheid aan voor:</h3>

    <!-- Weeknavigatie -->
    <div class="week-controls">
      <button id="prevWeekBtn"
              class="btn btn-icon"
              {% if not has_prev %}disabled aria-disabled="true"{% endif %}
              data-target="{{ prev_monday|date:'Y-m-d' }}"
              aria-label="Vorige week">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-icon lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
      </button>

      <div class="week-picker">
      <button id="weekPickerBtn"
              class="btn week-picker-btn"
              aria-haspopup="listbox"
              aria-expanded="false"
              aria-controls="weekMenu">
        <span class="wp-label">{{ header_title }}</span>
        <span class="wp-caret" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
              viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-chevron-down">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </span>
      </button>

        <div id="weekMenu" class="week-menu" role="listbox" tabindex="-1" hidden>
          {% for opt in week_options %}
            <div role="option"
                 class="week-option{% if opt.value == monday|date:'Y-m-d' %} is-active{% endif %}"
                 data-value="{{ opt.value }}"
                 aria-selected="{% if opt.value == monday|date:'Y-m-d' %}true{% else %}false{% endif %}">
              <strong>Week {{ opt.iso_week }} – {{ opt.iso_year }}</strong>
              <small>({{ opt.start|date:"d-m" }} – {{ opt.end|date:"d-m" }})</small>
            </div>
          {% endfor %}
        </div>
      </div>

    <button id="nextWeekBtn"
            class="btn btn-icon"
            {% if not has_next %}disabled aria-disabled="true"{% endif %}
            data-target="{{ next_monday|date:'Y-m-d' }}"
            aria-label="Volgende week">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right-icon lucide-arrow-right"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
    </button>
    </div>

    <div class="availability-daterange">
      {{ monday|date:"d-m-Y" }} – {{ week_end|date:"d-m-Y" }}
    </div>

    <form id="availabilityForm" method="post" action="">
      {% csrf_token %}
      <input type="hidden" id="redirectToMonday" name="redirect_to_monday" value="">

      <div class="availability-wrap">
        <table class="availability-table" aria-label="Beschikbaarheid maandag t/m zaterdag">
        <colgroup>
          <col style="width: 25%;" />
          <col style="width: 25%;" />
          <col style="width: 25%;" />
          <col style="width: 25%;" />
        </colgroup>
        <thead>
          <tr>
            <th>Dag</th>
            <th>Ochtend <small>09:00 - 13:00*</small></th>
            <th>Middag <small>13:00 - 17:30*</small></th>
            <th>Avond <small>18:00 - 20:00**</small></th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td>
                <div class="weekday-title">
                  <strong>{{ r.date|date:"D"|capfirst }}</strong>
                  <small>{{ r.date|date:"d-m" }}</small>
                </div>
              </td>
              <td><input type="checkbox" name="morning_{{ r.date|date:'Y-m-d' }}" {% if r.morning %}checked{% endif %}></td>
              <td><input type="checkbox" name="afternoon_{{ r.date|date:'Y-m-d' }}" {% if r.afternoon %}checked{% endif %}></td>
              <td><input type="checkbox" name="evening_{{ r.date|date:'Y-m-d' }}" {% if r.evening %}checked{% endif %}></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>

      <div class="availability-footer">
        <div class="availability-hints">
          <p><span>*</span> Als je zowel een ochtend als middagdienst hebt is er een half uur lunchpauze. Ook zijn er twee koffiepauzes.</p>
          <p><span>**</span> De avond en zaterdag worden niet standaard ingeroosterd, alleen bij speciale gelegenheden zoals feestdagen. Je krijgt dan een hogere vergoeding.</p>
        </div>
        
        <div class="actions">
          <button type="submit" class="btn btn-save" data-haptic>Opslaan</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/mijnbeschikbaarheid/mijnbeschikbaarheid.js' %}" defer></script>
{% endblock %}
