{% extends "base.html" %}
{% load static i18n %}

{% block title %}Beschikbaarheid{% endblock %}
{% block header_title %}Beschikbaarheid{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/mijnbeschikbaarheid/mijnbeschikbaarheid.css' %}">
{% endblock %}

{% block content %}
<div class="card">
  <div class="form">
              <div class="birthday-header agenda-section-header">
        <img src="{% static 'img/beschikbaarheid.svg' %}" alt="" class="birthday-icon">
        <div class="birthday-header-text">
        <h2>Beschikbaarheid doorgeven</h2>
        <p>Kies een week, vink je beschikbaarheid aan en klik op Opslaan om dit door te geven.</p>
        </div>
      </div>
      <hr class="crud-divider">

    <!-- Weeknavigatie -->
    <div class="week-controls">
      <button id="prevWeekBtn"
              class="btn btn-icon"
              {% if not has_prev %}disabled aria-disabled="true"{% endif %}
              data-target="{{ prev_monday|date:'Y-m-d' }}"
              aria-label="Vorige week">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-icon lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
      </button>

      <div class="week-picker">
      <button id="weekPickerBtn"
              class="btn week-picker-btn"
              aria-haspopup="listbox"
              aria-expanded="false"
              aria-controls="weekMenu">
        <span class="wp-label">{{ header_title }}</span>
        <span class="wp-caret" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
              viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-chevron-down">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </span>
      </button>

        <div id="weekMenu" class="week-menu" role="listbox" tabindex="-1" hidden>
          {% for opt in week_options %}
            <div role="option"
                 class="week-option{% if opt.value == monday|date:'Y-m-d' %} is-active{% endif %}"
                 data-value="{{ opt.value }}"
                 aria-selected="{% if opt.value == monday|date:'Y-m-d' %}true{% else %}false{% endif %}">
              <strong>Week {{ opt.iso_week }} – {{ opt.iso_year }}</strong>
              <small>({{ opt.start|date:"d-m" }} – {{ opt.end|date:"d-m" }})</small>
            </div>
          {% endfor %}
        </div>
      </div>

    <button id="nextWeekBtn"
            class="btn btn-icon"
            {% if not has_next %}disabled aria-disabled="true"{% endif %}
            data-target="{{ next_monday|date:'Y-m-d' }}"
            aria-label="Volgende week">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right-icon lucide-arrow-right"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
    </button>
    </div>

    <div class="availability-daterange">
      {{ monday|date:"d-m-Y" }} – {{ week_end|date:"d-m-Y" }}
    </div>

    <form id="availabilityForm" method="post" action="">
      {% csrf_token %}
      <input type="hidden" id="redirectToMonday" name="redirect_to_monday" value="">

      <div class="availability-wrap">
        <table class="availability-table" aria-label="Beschikbaarheid maandag t/m zaterdag">
        <colgroup>
          <col />
          <col />
          <col />
          <col />
        </colgroup>
        <thead>
          <tr>
            <th>Dag</th>
            {% for dd in dagdelen %}
              <th>
                {{ dd.name }}
                <small>{{ dd.start_time|time:"H:i" }} - {{ dd.end_time|time:"H:i" }}</small>
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td>
                <div class="weekday-title">
                  <strong>{{ r.date|date:"D"|capfirst }}</strong>
                  <small>{{ r.date|date:"d-m" }}</small>
                </div>
              </td>

              {% for dd in dagdelen %}
                {% with key=dd.code|add:"_"|add:r.date|date:"Y-m-d" %}
                  <td>
                    <input
                      type="checkbox"
                      name="{{ dd.code }}_{{ r.date|date:'Y-m-d' }}"
                      {% if dd.code in r.selected_codes %}checked{% endif %}
                    >
                  </td>
                {% endwith %}
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>

      <div class="availability-footer">
        <div class="availability-hints">
          <p><span>*</span> Als je zowel een ochtend als middagdienst hebt is er een half uur lunchpauze. Ook zijn er twee koffiepauzes.</p>
          <p><span>**</span> Sommige dagdelen worden niet standaard ingepland, zoals de avond en zaterdag diensten.</p>
        </div>
        
        <div class="actions">
          <button type="submit" class="btn btn-save" data-haptic>Opslaan</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/mijnbeschikbaarheid/mijnbeschikbaarheid.js' %}" defer></script>
{% endblock %}
