<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>Niet-leverlijst</title>

  <style>
    /* A4 LANDSCAPE */
    @page {
      size: A4 landscape;
      margin: 12mm 12mm 14mm 12mm;
    }

    .muted { color: #666; }

    /* HEADER (zelfde gevoel als STS halfjes) */
    .pdf-header{
        display: grid;
        grid-template-columns: 92px 1fr; /* logo kolom + content */
        gap: 16px;
        align-items: start;
        padding-bottom: 8px;     /* kleiner */
        margin-bottom: 8px;      /* kleiner */
        border-bottom: 1px solid #ddd;
    }

    /* Logo: zo hoog als het headerblok (metadata) */
    .pdf-logo{
        width: 92px;
        height: auto;
        max-height: 120px;       /* voorkomt absurd groot */
        object-fit: contain;
        display: block;
        margin-top: 2px;
    }

    .pdf-title{
        margin: 0;
        font-size: 18pt;
        color:#111;
        line-height: 1.1;
    }

    /* HEADER META: 3 kolommen (3x3 grid vibe, 3 kolommen breed) */
    .pdf-submeta{
        margin-top: 6px;
        margin-bottom: 6px;
        font-size: 10.5pt;
        color:#111;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr; /* 3 kolommen */
        gap: 4px 18px;          /* kleiner: minder verticale witruimte */
        max-width: 980px;       /* meer ruimte in landscape */
    }

    /* Dit voorkomt extra "lucht" onder meta */
    .pdf-submeta > div{
        margin: 0;
        padding: 0;
        line-height: 1.2;
    }

    .prepared-by{
        margin-top: 4px;         /* kleiner */
        font-size: 10pt;
    }

    .section-title{
        margin-top: 14px;        /* kleiner */
        font-weight: 700;
        color:#111;
        font-size: 11.5pt;
    }

    /* Tabel basis */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 10.5pt;
    }

    /* Herhaal header op elke pagina in PDF */
    thead { display: table-header-group; }
    tfoot { display: table-footer-group; }

    th, td {
        padding: 8px 8px;
        vertical-align: top;
        border-bottom: 1px solid #eee;
    }
    thead th {
        border-bottom: 1px solid #ccc;
        text-align: left;
        font-weight: 700;
        color: #111;
        background: #fafafa;
    }

    /* FOOTER (ongewijzigd) */
    .pdf-footer {
        font-size: 9pt;
        color: #444;
        margin-top: 14px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
        page-break-inside: avoid;
    }
    .footer-grid {
        display: grid;
        grid-template-columns: 1.2fr 1.6fr 1fr;
        gap: 24px;
        align-items: start;
    }
    .footer-block {
        line-height: 1.25;
        padding-right: 6px;
    }
    .footer-block:not(:last-child) {
        border-right: 1px solid #ddd;
        padding-right: 18px;
    }
    .footer-label {
        font-weight: 700;
        margin-bottom: 4px;
        padding-bottom: 2px;
        color: #111;
        border-bottom: 1px solid #ddd;
    }
    .footer-item { margin: 0; }
    .footer-strong { font-weight: 700; color: #111; }
    .authorisation { margin-top: 22px; page-break-inside: avoid; }
  </style>
</head>

<body>

  <!-- HEADER -->
  <div class="pdf-header">
    <div>
      {% if logo_path %}
        <img class="pdf-logo" src="file://{{ logo_path }}" alt="Logo">
      {% endif %}
    </div>

    <div>
      <h1 class="pdf-title">Niet-leverlijst</h1>

      <div class="pdf-submeta">
        <div><strong>Gegenereerd:</strong> {{ generated_at|date:"d-m-Y" }}</div>
        <div><strong>Organisatie:</strong> {{ selected_list.apotheek.name|default:"-" }}</div>
        <div><strong>Contact:</strong> {{ contact_email }}</div>

        <div><strong>Week:</strong> {{ selected_list.week }}</div>
        <div><strong>Dag:</strong> {{ selected_list.get_dag_display }}</div>
        <div><strong>Jaar:</strong> {{ selected_list.jaar }}</div>

        <div><strong>Datum:</strong>
          {% if dag_datum %}
            {{ dag_datum|date:"d-m-Y" }}
          {% else %}
            -
          {% endif %}
        </div>
        <div></div>
        <div></div>
      </div>

    </div>
  </div>

  <div class="section-title">Overzicht niet-geleverde geneesmiddelen</div>

  <!-- TABEL -->
  <table>
    <thead>
      <tr>
        <th style="width:4%; text-align:center; color:#666;"></th>
        <th style="width:11%;">Afdeling</th>
        <th style="width:18%;">PatiÃ«nt</th>
        <th style="width:12%;">Geboortedatum</th>
        <th style="width:41%;">Gevraagd geneesmiddel</th>
        <th style="width:14%;">Vanaf datum</th>
      </tr>
    </thead>

    <tbody>
      {% for item in entries %}
        <tr>
          <td style="width:4%; text-align:center; color:#666;">{{ forloop.counter }}</td>

          <td style="width:11%;">{{ item.afdeling|default:"-" }}</td>
          <td style="width:18%;">{{ item.patient_naam|default:"-" }}</td>

          <td style="width:12%; color:#666;">
            {% if item.patient_geboortedatum %}
              {{ item.patient_geboortedatum|date:"d-m-Y" }}
            {% else %}
              -
            {% endif %}
          </td>

          <td style="width:41%;">
            {% if item.gevraagd_geneesmiddel %}
              <strong>{{ item.gevraagd_geneesmiddel.naam }}</strong><br>
              <span class="muted">ZI-nummer: {{ item.gevraagd_geneesmiddel.zi_nummer }}</span>
            {% else %}
              -
            {% endif %}
          </td>

          <td style="width:14%; color:#666;">
            {% if item.vanaf_datum %}
              {{ item.vanaf_datum|date:"d-m-Y" }}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6" class="muted" style="text-align:center; padding:20px;">
            Geen entries gevonden.
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- FOOTER -->
  <div class="pdf-footer">
    <div class="footer-grid">
      <div class="footer-block">
        <div class="footer-label">Apotheek Jansen</div>
        <p class="footer-item">Kwaliteitshandboek</p>
      </div>

      <div class="footer-block">
        <div class="footer-label">Documentnummer</div>
        <p class="footer-item">F-KWAL-4</p>
      </div>

      <div class="footer-block">
        <div class="footer-label">Versiedatum</div>
        <p class="footer-item">Mei 2023</p>
      </div>
    </div>
  </div>

  <!-- AUTHORISATIE -->
  <div class="authorisation">
    <p style="margin-bottom: 8px; margin-top: 16px;">Document geauthoriseerd door,</p>

    <p style="margin: 0 0 8px 0;">
      <strong>Drs. Roel de Groot</strong>,<br>
      <span class="muted">Openbaar Apotheker</span>
    </p>

    {% if signature_path %}
      <img
        src="file://{{ signature_path }}"
        alt="Handtekening"
        style="height:50px; display:block; margin:10px 0 0 0;"
      >
    {% endif %}
  </div>

</body>
</html>