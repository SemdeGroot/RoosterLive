{% extends "two_factor/_base.html" %}
{% load i18n static %}

{% block pre_body %}
  {% if show_splash %}
    {% include "includes/splash.html" %}
  {% endif %}
{% endblock %}

{% block login_header_image %}
  {% load static %}
  {% if form.otp_token or form.token %}
    <div class="twofa-image-wrap">
      <img src="{% static 'img/2FA.png' %}" alt="2FA" class="twofa-image">
    </div>
  {% else %}
    <div class="logo-wrap default-logo">
      {% static 'img/logo.jpg' as static_logo %}
      <img class="logo" src="{% firstof logo_url static_logo %}" alt="Apotheek Jansen">
    </div>
  {% endif %}
{% endblock %}

{% block content %}

  {# GEEN messages hier: _base.html rendert ze al #}

  <form method="post" autocomplete="off" novalidate>
    {% csrf_token %}
    {{ wizard.management_form }}

    {# STAP 1: username + password #}
    {% if form.username and form.password %}
      <label for="{{ form.username.id_for_label }}">Voornaam / E-mail</label>
      {{ form.username }}

      <label for="{{ form.password.id_for_label }}">Wachtwoord</label>
      {{ form.password }}

      <button type="submit">{% trans "Inloggen" %}</button>

      <!-- Passkey status message (geen ruimte totdat JS 'm toont) -->
      <p id="passkeyStatus"
         class="passkey-message"
         aria-live="polite"
         aria-atomic="true"></p>

      <p class="forgot-password forgot-password--left">
        <a href="{% url 'password_reset' %}">Wachtwoord vergeten?</a>
      </p>

      <p class="forgot-password forgot-password--right">
        <a href="#" data-action="email"
          onclick="openContactModal(this.dataset.action); return false;">
          E-mail opnieuw instellen?
        </a>
      </p>

    {# STAP 2: TOTP code (veldnaam kan otp_token of token heten) #}
    {% elif form.otp_token or form.token %}
      <h1 style="text-align:center;">{% trans "Voer je 2FA-code in" %}</h1>
      <p class="twofa-logintext muted">
        Open je authenticator app en vul de 6-cijferige code in.
      </p>

      {% if form.otp_token %}
        <label for="{{ form.otp_token.id_for_label }}">6-cijferige code</label>
        {{ form.otp_token }}
      {% else %}
        <label for="{{ form.token.id_for_label }}">6-cijferige code</label>
        {{ form.token }}
      {% endif %}

      <button type="submit">{% trans "Bevestigen" %}</button>

      <p class="forgot-password forgot-password--center">
        <a href="#" data-action="2fa"
          onclick="openContactModal(this.dataset.action); return false;">
          2FA opnieuw instellen?
        </a>
      </p>

    {% endif %}

    <div id="contactModal" class="contact-modal">
      <div class="contact-modal-content">
        <div class="contact-header">
          <h3>Contacteer beheer</h3>
          <span class="contact-close" onclick="closeContactModal()" aria-label="Sluiten">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </span>
        </div>
        <p id="contactModalBody"></p>
      </div>
    </div>
  </form>

{% endblock %}
