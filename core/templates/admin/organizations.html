{% extends "base.html" %}
{% load static role_tags form_extras %}
{% block title %}Organisaties beheren{% endblock %}
{% block header_title %}Organisaties beheren{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/base/table.css' %}">
  <link rel="stylesheet" href="{% static 'css/admin/admin_panel.css' %}">
  <script src="{% static 'js/base/table.js' %}" defer></script>
  <script src="{% static 'js/admin/admin_panel.js' %}" defer></script>
{% endblock %}

{% block content %}

<div class="admin-wrap">
    <div class="card" id="org-card">
      <div class="card-inner">
            <div class="birthday-header agenda-section-header">
                <span
                  class="birthday-icon icon-badge i-sky"
                  style="--icon: url('{% static 'img/lucide/admin-organisaties-lucide.svg' %}');"
                  aria-hidden="true">
                </span>
                <div class="birthday-header-text">
                    <h2>Organisaties beheren</h2>
                    <p>Voeg hier organisaties toe of bewerk de gegevens.</p>
                </div>
                <a href="{% url 'beheer_tiles' %}" class="btn btn-save">
        Terug naar Beheer</a>
                </div>
                <hr class="crud-divider">
        <h3 style="margin-top:0;">Organisatie toevoegen</h3>

        <form method="post" autocomplete="off">
          {% csrf_token %}
          <input type="hidden" name="form_kind" value="org">

          <div class="form form-sticky-actions" style="padding:0;">
            <label for="org_name">Naam organisatie:</label>
            <input class="admin-input" type="text" name="name" id="org_name" required>

            <label for="org_type">Type organisatie:</label>
            <select class="admin-select" name="org_type" id="org_type" required>
              <option value="apotheek" selected>Apotheek</option>
              <option value="zorginstelling">Zorginstelling</option>
            </select>

            <label for="org_email">E-mailadres:</label>
            <input class="admin-input" type="email" name="email" id="org_email" required>

            <label for="org_email2">E-mailadres 2:</label>
            <input class="admin-input" type="email" name="email2" id="org_email2">

            <label for="org_phone">Telefoonnummer:</label>
            <input class="admin-input" type="text" name="phone" id="org_phone">

            <button class="btn btn-save btn-block" type="submit">Opslaan</button>
          </div>
        </form>

        <hr class="crud-divider">
        <h3 style="margin-top:0;">Bestaande organisaties</h3>

        <div class="search-bar">
          <input type="text" id="orgSearch" placeholder="Typ om te zoekenâ€¦">
        </div>

        <div data-crud data-table="#orgTable" data-rows="#orgTable .org-row" data-page-size="10">
          <div class="table-scroll">
            <table class="crud-table compact org-table" id="orgTable">
              <thead>
                <tr>
                  <th>Organisatie</th>
                  <th>E-mail</th>
                  <th>Telefoon</th>
                  <th data-nosort>Acties</th>
                </tr>
              </thead>

              <tbody>
                {% for org in organizations %}
                <tr class="org-row" id="org-row-{{ org.id }}">
                  <td class="wrap">{{ org.name }}</td>
                  <td class="wrap">{{ org.email|default:"-" }}</td>
                  <td class="wrap">{{ org.phone|default:"-" }}</td>

                  <td>
                    {% if can_manage %}
                    <div class="actions-wrap horizontal">
                      <button type="button"
                              class="icon-btn"
                              onclick="toggleOrgEdit('{{ org.id }}')"
                              aria-label="Bewerken">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                             stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round">
                          <path d="M12 20h9"/>
                          <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                        </svg>
                      </button>

                      <form method="post"
                            action="{% url 'org_delete' org.id %}"
                            onsubmit="return confirmOrgDelete('{{ org.name|escapejs }}');">
                        {% csrf_token %}
                        <button class="icon-btn danger" type="submit" aria-label="Verwijderen">
                          <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                               stroke="currentColor" stroke-width="2"
                               stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                          </svg>
                        </button>
                      </form>
                    </div>
                    {% else %}
                        <span style="color:var(--muted); font-size: 0.9em; font-style:italic;">Geen rechten</span>
                    {% endif %}
                  </td>
                </tr>

                <tr id="org-edit-row-{{ org.id }}" class="edit-row" style="display:none;">
                  <td colspan="4">
                    <div class="edit-wrap">
                      <form method="post" action="{% url 'org_update' org.id %}">
                        {% csrf_token %}

                        <div class="edit-grid">
                          <div>
                            <label>Naam organisatie:</label>
                            <input class="admin-input" type="text" name="name"
                                   value="{{ org.name }}" style="margin-top:6px;">
                          </div>
                          <div>
                            <label>Type organisatie:</label>
                            <select name="org_type" class="admin-select" style="margin-top:6px;">
                              <option value="apotheek" {% if org.org_type == "apotheek" %}selected{% endif %}>Apotheek</option>
                              <option value="zorginstelling" {% if org.org_type == "zorginstelling" %}selected{% endif %}>Zorginstelling</option>
                            </select>
                          </div>
                          <div>
                            <label>E-mailadres:</label>
                            <input class="admin-input" type="email" name="email"
                                   value="{{ org.email }}" style="margin-top:6px;">
                          </div>
                          <div>
                            <label>E-mailadres 2:</label>
                            <input class="admin-input" type="email" name="email2"
                                   value="{{ org.email2 }}" style="margin-top:6px;">
                          </div>
                          <div>
                            <label>Telefoonnummer:</label>
                            <input class="admin-input" type="text" name="phone"
                                   value="{{ org.phone }}" style="margin-top:6px;">
                          </div>
                        </div>

                        <div class="actions-wrap horizontal" style="margin-top:12px;">
                          <button class="btn btn-save" type="submit">Opslaan</button>
                          <button type="button" class="btn btn-danger" onclick="toggleOrgEdit('{{ org.id }}')">Annuleren</button>
                        </div>
                      </form>
                    </div>
                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="4">Nog geen organisaties.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="crud-more-wrap">
            <button class="btn" type="button" data-crud-more>Toon meer</button>
          </div>
        </div>

      </div>
    </div>
</div>
{% endblock %}