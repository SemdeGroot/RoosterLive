{% extends "base.html" %}
{% load static i18n %}

{% block title %}Teamdashboard{% endblock %}
{% block header_title %}Teamdashboard{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/personeelsdashboard/personeelsdashboard.css' %}">
{% endblock %}

{% block content %}
<div class="card">
  <div class="form">
    <h3 style="margin:0 0 8px 0;">Overzicht beschikbaarheden voor:</h3>

    <!-- Weeknavigatie: zelfde markup/uiterlijk als beschikbaarheid + eigen scroller -->
    <div class="week-wrap">
      <div class="week-controls">
        <button id="prevWeekBtn"
                class="btn btn-icon"
                {% if not has_prev %}disabled aria-disabled="true"{% endif %}
                data-target="{{ prev_monday|date:'Y-m-d' }}"
                aria-label="Vorige week">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               class="lucide lucide-arrow-left">
            <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
          </svg>
        </button>

        <div class="week-picker">
          <button id="weekPickerBtn"
                  class="btn week-picker-btn"
                  aria-haspopup="listbox"
                  aria-expanded="false"
                  aria-controls="weekMenu">
            <span class="wp-label">{{ header_title }}</span>
            <span class="wp-caret" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor"
                   stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                   class="lucide lucide-chevron-down">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </span>
          </button>

          <!-- Wordt bij openen naar <body> geportaled -->
          <div id="weekMenu" class="week-menu" role="listbox" tabindex="-1" hidden>
            {% for opt in week_options %}
              <div role="option"
                   class="week-option{% if opt.value == monday|date:'Y-m-d' %} is-active{% endif %}"
                   data-value="{{ opt.value }}"
                   aria-selected="{% if opt.value == monday|date:'Y-m-d' %}true{% else %}false{% endif %}">
                <strong>Week {{ opt.iso_week }} – {{ opt.iso_year }}</strong>
                <small>({{ opt.start|date:"d-m" }} – {{ opt.end|date:"d-m" }})</small>
              </div>
            {% endfor %}
          </div>
        </div>

        <button id="nextWeekBtn"
                class="btn btn-icon"
                {% if not has_next %}disabled aria-disabled="true"{% endif %}
                data-target="{{ next_monday|date:'Y-m-d' }}"
                aria-label="Volgende week">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               class="lucide lucide-arrow-right">
            <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="availability-daterange">
      {{ monday|date:"d-m-Y" }} – {{ week_end|date:"d-m-Y" }}
    </div>

    <!-- Scrollbare matrix -->
    <div class="matrix-wrap">
      <table class="matrix" id="matrixTable" aria-label="Beschikbaarheid per medewerker en dagdeel">
        <colgroup>
          <col /><col />
          {% for d in days_ctx %}<col /><col />{% endfor %}
        </colgroup>
        <thead>
          <tr>
            <th>Groep</th>
            <th>Voornaam</th>
            {% for day in days_ctx %}
              <th colspan="2">{{ day.weekday_label }}</th>
            {% endfor %}
          </tr>
          <tr>
            <th></th><th></th>
            {% for day in days_ctx %}
              <th><span class="slot-badge" data-slot="{{ day.iso }}|morning">Ochtend ({{ day.morning_count }})</span></th>
              <th><span class="slot-badge" data-slot="{{ day.iso }}|afternoon">Middag ({{ day.afternoon_count }})</span></th>
            {% endfor %}
          </tr>
        </thead>
        <tbody id="matrixBody">
          {% for r in rows %}
            <tr class="matrix-row" data-group="{{ r.group }}" data-firstname="{{ r.firstname }}" {{ r.data_attrs|safe }}>
              <td>{{ r.group }}</td>
              <td>{{ r.firstname }}</td>
              {% for c in r.cells %}
                <td><div class="avail-pill {% if c.morning %}available{% endif %}"></div></td>
                <td><div class="avail-pill {% if c.afternoon %}available{% endif %}"></div></td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/personeelsdashboard/personeelsdashboard.js' %}" defer></script>
{% endblock %}
