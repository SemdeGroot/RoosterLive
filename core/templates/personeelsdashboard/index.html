{% extends "base.html" %}
{% load static i18n %}

{% block title %}Teamdashboard{% endblock %}
{% block header_title %}Teamdashboard{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/personeelsdashboard/personeelsdashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/base/table.css' %}">
{% endblock %}

{% block content %}

<div class="admin-wrap personeelsdashboard-wrap">

  <!-- Top card: controls -->
  <div class="card">
    <div class="card-inner">

      <div class="pd-controlbar">

        <!-- Links: dagpicker (zonder label) -->
        <div class="pd-daypicker">
          <select id="dayPicker" class="admin-select pd-select" aria-label="Selecteer dag">
            {% for opt in day_options %}
              <option value="{{ opt.idx }}" {% if opt.idx == selected_day_idx %}selected{% endif %}>
                {{ opt.weekday_label }} ({{ opt.date|date:"d-m" }})
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Midden: weeknavigator + datum eronder (gecentreerd) -->
        <div class="pd-weekcenter">
          <div class="week-wrap">
            <div class="week-controls">
              <button id="prevWeekBtn"
                      class="btn btn-icon"
                      {% if not has_prev %}disabled aria-disabled="true"{% endif %}
                      data-target="{{ prev_monday|date:'Y-m-d' }}"
                      aria-label="Vorige week">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="lucide lucide-arrow-left">
                  <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
                </svg>
              </button>

              <div class="week-picker">
                <button id="weekPickerBtn"
                        class="btn week-picker-btn"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                        aria-controls="weekMenu">
                  <span class="wp-label">{{ header_title }}</span>
                  <span class="wp-caret" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                         viewBox="0 0 24 24" fill="none" stroke="currentColor"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         class="lucide lucide-chevron-down">
                      <polyline points="6 9 12 15 18 9"/>
                    </svg>
                  </span>
                </button>

                <!-- Wordt bij openen naar <body> geportaled -->
                <div id="weekMenu" class="week-menu" role="listbox" tabindex="-1" hidden>
                  {% for opt in week_options %}
                    <div role="option"
                         class="week-option{% if opt.value == monday|date:'Y-m-d' %} is-active{% endif %}"
                         data-value="{{ opt.value }}"
                         aria-selected="{% if opt.value == monday|date:'Y-m-d' %}true{% else %}false{% endif %}">
                      <strong>Week {{ opt.iso_week }} – {{ opt.iso_year }}</strong>
                      <small>({{ opt.start|date:"d-m" }} – {{ opt.end|date:"d-m" }})</small>
                    </div>
                  {% endfor %}
                </div>
              </div>

              <button id="nextWeekBtn"
                      class="btn btn-icon"
                      {% if not has_next %}disabled aria-disabled="true"{% endif %}
                      data-target="{{ next_monday|date:'Y-m-d' }}"
                      aria-label="Volgende week">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="lucide lucide-arrow-right">
                  <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
                </svg>
              </button>
            </div>

            <!-- Datum gecentreerd onder de week picker -->
            <div class="availability-daterange">
              {{ monday|date:"d-m-Y" }} – {{ week_end|date:"d-m-Y" }}
            </div>
          </div>
        </div>

        <!-- Rechts: leeg (voor spacing zodat midden echt center blijft) -->
        <div class="pd-right-spacer" aria-hidden="true"></div>

      </div>

    </div>
  </div>

  <!-- Main: left matrix + right panel -->
  <div class="pd-main-grid">

    <!-- Links: grid -->
    <div class="card">
      <div class="card-inner">

        <div class="pd-left-header">
          <div>
            <h3 style="margin:0;">Overzicht – {{ selected_day_ctx.weekday_label }}</h3>
            <p class="pd-subtitle" style="margin:4px 0 0 0;">
              Sorteer door op de dagdelen te klikken.
            </p>
          </div>
        </div>

        <hr class="crud-divider">

        <div class="search-bar">
          <input type="text"
                 id="userSearch"
                 placeholder="Zoek op groep of naam…"
                 class="admin-input">
        </div>

        <div class="matrix-wrap">
          <table class="matrix" id="matrixTable" aria-label="Beschikbaarheid per medewerker en dagdeel">
            <colgroup>
              <col class="col-group" />
              <col class="col-name" />
              <col class="col-slot" />
              <col class="col-slot" />
              <col class="col-slot" />
            </colgroup>

            <thead>
              <tr>
                <th class="no-vlines">Groep</th>
                <th class="no-vlines">Voornaam</th>

                <th class="slot-head">
                  <span class="slot-badge" data-slot="{{ selected_day_ctx.iso }}|morning">
                    Ochtend <small>({{ selected_day_ctx.morning_count }})</small>
                  </span>
                </th>
                <th class="slot-head">
                  <span class="slot-badge" data-slot="{{ selected_day_ctx.iso }}|afternoon">
                    Middag <small>({{ selected_day_ctx.afternoon_count }})</small>
                  </span>
                </th>
                <th class="slot-head">
                  <span class="slot-badge" data-slot="{{ selected_day_ctx.iso }}|evening">
                    Avond <small>({{ selected_day_ctx.evening_count }})</small>
                  </span>
                </th>
              </tr>
            </thead>

            <tbody id="matrixBody">
              {% for r in rows %}
                <tr class="matrix-row"
                    data-group="{{ r.group }}"
                    data-firstname="{{ r.firstname }}"
                    {{ r.data_attrs|safe }}>

                  <td class="cell-wrap no-vlines">{{ r.group }}</td>
                  <td class="cell-wrap no-vlines">{{ r.firstname }}</td>

                  <td class="slot-cell">
                    <div class="avail-rect {% if r.cell.morning %}available{% endif %}" aria-label="Ochtend"></div>
                  </td>
                  <td class="slot-cell">
                    <div class="avail-rect {% if r.cell.afternoon %}available{% endif %}" aria-label="Middag"></div>
                  </td>
                  <td class="slot-cell">
                    <div class="avail-rect {% if r.cell.evening %}available{% endif %}" aria-label="Avond"></div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- Rechts: actiepaneel -->
    <div class="card">
      <div class="card-inner">
        <h3 style="margin-top:0;">Actiepaneel</h3>
        <p class="pd-subtitle" style="margin:0;">
          Hier kun je straks taken toewijzen en beschikbaarheden accepteren (rechthoeken → groen).
        </p>
      </div>
    </div>

  </div>

</div>

{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/personeelsdashboard/personeelsdashboard.js' %}" defer></script>
{% endblock %}
