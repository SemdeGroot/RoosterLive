{% extends "base.html" %}
{% load static %}

{% block title %}Agenda{% endblock %}
{% block header_title %}Agenda{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/agenda/agenda.css' %}">
  <link rel="stylesheet" href="{% static 'css/diensten/diensten.css' %}">
  <script src="{% static 'js/agenda/agenda.js' %}" defer></script>
  <script src="{% static 'js/diensten/diensten.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="card birthdays-card">

  {# --------- ALGEMENE AGENDA --------- #}
  <div class="agenda-section">
    <div class="birthday-header agenda-section-header">
    <span
      class="birthday-icon icon-badge i-sky"
      style="--icon: url('{% static 'img/lucide/algemene-agenda-lucide.svg' %}');"
      aria-hidden="true">
    </span>

      <div class="birthday-header-text">
        <h2>Algemeen</h2>
        <p>Algemene agenda</p>
      </div>

      <div class="header-actions">
        <button
          type="button"
          id="syncAgendaBtn"
          class="btn btn-save"
          data-webcal="{{ webcal_url }}"
          data-https="{{ webcal_https_url }}"
          title="Synchroniseer met agenda app"
        >
          Synchroniseer met agenda app
        </button>

        {% if can_edit %}
          <button
            type="button"
            class="btn btn-save js-toggle-form"
            data-target="#agenda-form-general"
            aria-expanded="false"
            aria-controls="agenda-form-general"
            title="Agendapunt toevoegen"
          >
            Toevoegen
          </button>
        {% endif %}
      </div>
    </div>

    {% if can_edit %}
      <form
        id="agenda-form-general"
        class="form agenda-inline-form {% if not new_general_form.errors %}is-hidden{% endif %}"
        method="post"
        autocomplete="off"
        data-lock-submit="1"
      >
        {% csrf_token %}
        <input type="hidden" name="add_category" value="general">
        {{ new_general_form.non_field_errors }}

        <label for="{{ new_general_form.title.id_for_label }}">Titel (max 50 karakters):</label>
        {{ new_general_form.title.errors }}
        {{ new_general_form.title }}

        <label for="{{ new_general_form.description.id_for_label }}">Beschrijving (max 100 karakters):</label>
        {{ new_general_form.description.errors }}
        {{ new_general_form.description }}

        <label for="{{ new_general_form.date.id_for_label }}">Datum:</label>
        {{ new_general_form.date.errors }}
        <input
          type="text"
          id="{{ new_general_form.date.id_for_label }}"
          name="{{ new_general_form.date.html_name }}"
          class="js-date"
          placeholder="dd-mm-jjjj"
          inputmode="numeric"
          autocomplete="off"
          value="{{ new_general_form.date.value|default_if_none:'' }}"
        >
        <label for="{{ new_general_form.start_time.id_for_label }}">Starttijd (optioneel):</label>
        {{ new_general_form.start_time.errors }}
        {{ new_general_form.start_time }}

        <label for="{{ new_general_form.end_time.id_for_label }}" style="margin-top:10px;">Eindtijd (optioneel):</label>
        {{ new_general_form.end_time.errors }}
        {{ new_general_form.end_time }}
        <small style="color:var(--muted); display:block; margin-top:0px;">
          Vul start- én eindtijd in. Laat leeg voor "hele dag" in agenda.
        </small>

        <div class="actions-wrap horizontal" style="margin-top:12px; display:flex; justify-content:space-between; gap:16px;">
          <button
            type="button"
            class="btn btn-danger js-cancel-form"
            data-target="#agenda-form-general"
          >
            Annuleren
          </button>

          <button type="submit" class="btn btn-save" data-submit-btn>
            Opslaan
          </button>
        </div>
      </form>
    {% endif %}

    {% if general_items %}
      <ul class="birthday-list agenda-list">
        {% for item, edit_form in general_rows %}
          <li class="birthday-item">
            <div class="agenda-item-row">
              <div class="birthday-main">
                <div class="birthday-left">
                  <span class="birthday-name">{{ item.title }}</span>
                  <div class="birthday-meta">
                    <span class="agenda-description">{{ item.description }}</span>
                  </div>
                </div>

                <div class="birthday-right">
                  <span class="birthday-date">
                    <span class="date-line">{{ item.date|date:"d-m-Y" }}</span>

                    {% if item.start_time and item.end_time %}
                      <span class="time-line">
                        {{ item.start_time|time:"H:i" }} – {{ item.end_time|time:"H:i" }}
                      </span>
                    {% endif %}
                  </span>
                </div>
              </div>

              {% if can_edit %}
                <div class="agenda-actions">
                  <button
                    type="button"
                    class="icon-btn js-toggle-form"
                    data-target="#agenda-edit-general-{{ item.id }}"
                    aria-expanded="{% if open_edit_id == item.id %}true{% else %}false{% endif %}"
                    aria-controls="agenda-edit-general-{{ item.id }}"
                    title="Bewerken"
                    aria-label="Bewerken"
                  >
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                         stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 20h9"/>
                      <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                    </svg>
                  </button>

                  <form method="post" class="agenda-delete-form">
                    {% csrf_token %}
                    <button
                      type="submit"
                      value="{{ item.id }}"
                      name="delete_item"
                      class="icon-btn danger"
                      title="Verwijderen"
                      aria-label="Verwijderen"
                      data-submit-btn
                    >
                      <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                           stroke="currentColor" stroke-width="2"
                           stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                      </svg>
                    </button>
                  </form>
                </div>
              {% endif %}
            </div>

            {% if can_edit %}
              <form
                id="agenda-edit-general-{{ item.id }}"
                class="form agenda-inline-form agenda-edit-form {% if open_edit_id != item.id and not edit_form.errors %}is-hidden{% endif %}"
                method="post"
                autocomplete="off"
                data-lock-submit="1"
              >
                {% csrf_token %}
                <input type="hidden" name="edit_item" value="{{ item.id }}">
                <input type="hidden" name="edit_category" value="general">
                {{ edit_form.non_field_errors }}

                <label for="{{ edit_form.title.id_for_label }}">Titel (max 50 karakters):</label>
                {{ edit_form.title.errors }}
                {{ edit_form.title }}

                <label for="{{ edit_form.description.id_for_label }}">Beschrijving (max 100 karakters):</label>
                {{ edit_form.description.errors }}
                {{ edit_form.description }}

                <label for="{{ edit_form.date.id_for_label }}">Datum:</label>
                {{ edit_form.date.errors }}
                <input
                  type="text"
                  id="{{ edit_form.date.id_for_label }}"
                  name="{{ edit_form.date.html_name }}"
                  class="js-date"
                  placeholder="dd-mm-jjjj"
                  inputmode="numeric"
                  autocomplete="off"
                  value="{% if edit_form.is_bound %}{{ edit_form.date.value|default_if_none:'' }}{% else %}{{ item.date|date:'d-m-Y' }}{% endif %}"
                >
                <label for="{{ edit_form.start_time.id_for_label }}">Starttijd (optioneel):</label>
                {{ edit_form.start_time.errors }}
                {{ edit_form.start_time }}

                <label for="{{ edit_form.end_time.id_for_label }}" style="margin-top:10px;">Eindtijd (optioneel):</label>
                {{ edit_form.end_time.errors }}
                {{ edit_form.end_time }}
                 <small style="color:var(--muted); display:block; margin-top:0px;">
                  Vul start- én eindtijd in. Laat leeg voor "hele dag" in agenda.
                </small>

                <div class="actions-wrap horizontal" style="margin-top:12px; display:flex; justify-content:space-between; gap:16px;">
                  <button
                    type="button"
                    class="btn btn-danger js-cancel-form"
                    data-target="#agenda-edit-general-{{ item.id }}"
                  >
                    Annuleren
                  </button>

                  <button type="submit" class="btn btn-save" data-submit-btn>
                    Opslaan
                  </button>
                </div>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="birthday-empty">
        Geen algemene agendapunten.
      </p>
    {% endif %}
  </div>

  {# --------- UITJES --------- #}
  <div class="agenda-section">
    <div class="birthday-header agenda-section-header">
    <span
      class="birthday-icon icon-badge i-teal"
      style="--icon: url('{% static 'img/lucide/uitjes-lucide.svg' %}');"
      aria-hidden="true">
    </span>
      <div class="birthday-header-text">
        <h2>Uitjes</h2>
        <p>Geplande uitjes</p>
      </div>

      {% if can_edit %}
        <button
          type="button"
          class="btn btn-save js-toggle-form"
          data-target="#agenda-form-outing"
          aria-expanded="false"
          aria-controls="agenda-form-outing"
          title="Uitje toevoegen"
        >
          Toevoegen
        </button>
      {% endif %}
    </div>

    {% if can_edit %}
      <form
        id="agenda-form-outing"
        class="form agenda-inline-form {% if not new_outing_form.errors %}is-hidden{% endif %}"
        method="post"
        autocomplete="off"
        data-lock-submit="1"
      >
        {% csrf_token %}
        <input type="hidden" name="add_category" value="outing">
        {{ new_outing_form.non_field_errors }}

        <label for="{{ new_outing_form.title.id_for_label }}">Titel (max 50 karakters):</label>
        {{ new_outing_form.title.errors }}
        {{ new_outing_form.title }}

        <label for="{{ new_outing_form.description.id_for_label }}">Beschrijving (max 100 karakters):</label>
        {{ new_outing_form.description.errors }}
        {{ new_outing_form.description }}

        <label for="{{ new_outing_form.date.id_for_label }}">Datum:</label>
        {{ new_outing_form.date.errors }}
        <input
          type="text"
          id="{{ new_outing_form.date.id_for_label }}"
          name="{{ new_outing_form.date.html_name }}"
          class="js-date"
          placeholder="dd-mm-jjjj"
          inputmode="numeric"
          autocomplete="off"
          value="{{ new_outing_form.date.value|default_if_none:'' }}"
        >
        <label for="{{ new_outing_form.start_time.id_for_label }}">Starttijd (optioneel):</label>
        {{ new_outing_form.start_time.errors }}
        {{ new_outing_form.start_time }}

        <label for="{{ new_outing_form.end_time.id_for_label }}" style="margin-top:10px;">Eindtijd (optioneel):</label>
        {{ new_outing_form.end_time.errors }}
        {{ new_outing_form.end_time }}
        <small style="color:var(--muted); display:block; margin-top:0px;">
          Vul start- én eindtijd in. Laat leeg voor "hele dag" in agenda.
        </small>

        <div class="actions-wrap horizontal" style="margin-top:12px; display:flex; justify-content:space-between; gap:16px;">
          <button
            type="button"
            class="btn btn-danger js-cancel-form"
            data-target="#agenda-form-outing"
          >
            Annuleren
          </button>

          <button type="submit" class="btn btn-save" data-submit-btn>
            Opslaan
          </button>
        </div>
      </form>
    {% endif %}

    {% if outing_items %}
      <ul class="birthday-list agenda-list">
        {% for item, edit_form in outing_rows %}
          <li class="birthday-item">
            <div class="agenda-item-row">
              <div class="birthday-main">
                <div class="birthday-left">
                  <span class="birthday-name">{{ item.title }}</span>
                  <div class="birthday-meta">
                    <span class="agenda-description">{{ item.description }}</span>
                  </div>
                </div>

                <div class="birthday-right">
                  <span class="birthday-date">
                    <span class="date-line">{{ item.date|date:"d-m-Y" }}</span>

                    {% if item.start_time and item.end_time %}
                      <span class="time-line">
                        {{ item.start_time|time:"H:i" }} – {{ item.end_time|time:"H:i" }}
                      </span>
                    {% endif %}
                  </span>
                </div>
              </div>

              {% if can_edit %}
                <div class="agenda-actions">
                  <button
                    type="button"
                    class="icon-btn js-toggle-form"
                    data-target="#agenda-edit-outing-{{ item.id }}"
                    aria-expanded="{% if open_edit_id == item.id %}true{% else %}false{% endif %}"
                    aria-controls="agenda-edit-outing-{{ item.id }}"
                    title="Bewerken"
                    aria-label="Bewerken"
                  >
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                         stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 20h9"/>
                      <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                    </svg>
                  </button>

                  <form method="post" class="agenda-delete-form">
                    {% csrf_token %}
                    <button
                      type="submit"
                      value="{{ item.id }}"
                      name="delete_item"
                      class="icon-btn danger"
                      title="Verwijderen"
                      aria-label="Verwijderen"
                      data-submit-btn
                    >
                      <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                           stroke="currentColor" stroke-width="2"
                           stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                      </svg>
                    </button>
                  </form>
                </div>
              {% endif %}
            </div>

            {% if can_edit %}
              <form
                id="agenda-edit-outing-{{ item.id }}"
                class="form agenda-inline-form agenda-edit-form {% if open_edit_id != item.id and not edit_form.errors %}is-hidden{% endif %}"
                method="post"
                autocomplete="off"
                data-lock-submit="1"
              >
                {% csrf_token %}
                <input type="hidden" name="edit_item" value="{{ item.id }}">
                <input type="hidden" name="edit_category" value="outing">
                {{ edit_form.non_field_errors }}

                <label for="{{ edit_form.title.id_for_label }}">Titel (max 50 karakters):</label>
                {{ edit_form.title.errors }}
                {{ edit_form.title }}

                <label for="{{ edit_form.description.id_for_label }}">Beschrijving (max 100 karakters):</label>
                {{ edit_form.description.errors }}
                {{ edit_form.description }}

                <label for="{{ edit_form.date.id_for_label }}">Datum:</label>
                {{ edit_form.date.errors }}
                <input
                  type="text"
                  id="{{ edit_form.date.id_for_label }}"
                  name="{{ edit_form.date.html_name }}"
                  class="js-date"
                  placeholder="dd-mm-jjjj"
                  inputmode="numeric"
                  autocomplete="off"
                  value="{% if edit_form.is_bound %}{{ edit_form.date.value|default_if_none:'' }}{% else %}{{ item.date|date:'d-m-Y' }}{% endif %}"
                >
                <label for="{{ edit_form.start_time.id_for_label }}">Starttijd (optioneel):</label>
                {{ edit_form.start_time.errors }}
                {{ edit_form.start_time }}

                <label for="{{ edit_form.end_time.id_for_label }}" style="margin-top:10px;">Eindtijd (optioneel):</label>
                {{ edit_form.end_time.errors }}
                {{ edit_form.end_time }}
                <small style="color:var(--muted); display:block; margin-top:0px;">
                  Vul start- én eindtijd in. Laat leeg voor "hele dag" in agenda.
                </small>

                <div class="actions-wrap horizontal" style="margin-top:12px; display:flex; justify-content:space-between; gap:16px;">
                  <button
                    type="button"
                    class="btn btn-danger js-cancel-form"
                    data-target="#agenda-edit-outing-{{ item.id }}"
                  >
                    Annuleren
                  </button>

                  <button type="submit" class="btn btn-save" data-submit-btn>
                    Opslaan
                  </button>
                </div>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="birthday-empty">
        Geen uitjes gepland.
      </p>
    {% endif %}
  </div>

  {# --------- VERJAARDAGEN --------- #}
  <div class="agenda-section">
    <div class="birthday-header">
    <span
      class="birthday-icon icon-badge i-rose"
      style="--icon: url('{% static 'img/lucide/verjaardagen-lucide.svg' %}');"
      aria-hidden="true">
    </span>
      <div class="birthday-header-text">
        <h2>Verjaardagen</h2>
        <p>Vandaag t/m {{ four_weeks_later|date:"j F"|lower }}</p>
      </div>
    </div>

    {% if birthdays %}
      <ul class="birthday-list">
        {% for b in birthdays %}
          <li class="birthday-item {% if b.is_today %}birthday-today{% endif %}">
            <div class="birthday-main">
              <div class="birthday-left">
                <span class="birthday-name">{{ b.name }}</span>
              </div>

              <div class="birthday-right">
                {% if b.is_today %}
                  <span class="birthday-today-chip">
                    Jarig vandaag!
                    <span class="birthday-confetti">
                      <img
                        src="{% static 'img/confetti.svg' %}"
                        alt=""
                        class="birthday-confetti-icon"
                      >
                    </span>
                  </span>
                {% elif b.is_tomorrow %}
                  <span class="birthday-date">
                    Morgen
                  </span>
                {% else %}
                  <span class="birthday-date">
                    {{ b.date|date:"d-m-Y" }}
                  </span>
                {% endif %}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="birthday-empty">
        Geen verjaardagen in de komende vier weken.
      </p>
    {% endif %}
  </div>

</div>

{# IMask + toggle/cancel blijven zoals je had #}
<script src="https://unpkg.com/imask"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Toggle forms
    document.querySelectorAll(".js-toggle-form").forEach(function (btn) {
      btn.addEventListener("click", function () {
        var targetSelector = btn.getAttribute("data-target");
        if (!targetSelector) return;

        var form = document.querySelector(targetSelector);
        if (!form) return;

        var isHidden = form.classList.toggle("is-hidden");
        btn.setAttribute("aria-expanded", isHidden ? "false" : "true");

        if (!isHidden) {
          var firstField = form.querySelector("input, textarea");
          if (firstField) firstField.focus();
        }
      });
    });

    // Annuleren
    document.querySelectorAll(".js-cancel-form").forEach(function (btn) {
      btn.addEventListener("click", function () {
        var targetSelector = btn.getAttribute("data-target");
        if (!targetSelector) return;

        var form = document.querySelector(targetSelector);
        if (!form) return;

        form.classList.add("is-hidden");

        var toggleBtn = document.querySelector('.js-toggle-form[data-target="' + targetSelector + '"]');
        if (toggleBtn) toggleBtn.setAttribute("aria-expanded", "false");
      });
    });

    // Date mask voor alle .js-date velden (dd-mm-jjjj)
    document.querySelectorAll(".js-date").forEach(function (input) {
      IMask(input, {
        mask: 'd-m-Y',
        lazy: true,
        overwrite: true,
        autofix: false,
        blocks: {
          d: { mask: IMask.MaskedRange, from: 1, to: 31, maxLength: 2 },
          m: { mask: IMask.MaskedRange, from: 1, to: 12, maxLength: 2 },
          Y: { mask: IMask.MaskedRange, from: 1900, to: 2100, maxLength: 4 }
        }
      });
    });
    document.querySelectorAll(".js-time").forEach(function (input) {
      IMask(input, {
        mask: "H:M",
        lazy: true,
        overwrite: true,
        blocks: {
          H: { mask: IMask.MaskedRange, from: 0, to: 23, maxLength: 2 },
          M: { mask: IMask.MaskedRange, from: 0, to: 59, maxLength: 2 }
        }
      });
    });
  });
</script>

<!-- Modal -->
<div id="agendaModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.6);">
  <div class="modal-content diensten-modal"
       style="background-color:var(--panel); margin:10% auto; padding:25px; border:1px solid var(--border); width:90%; border-radius:12px; max-width:640px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);">

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom: 1px solid var(--border); padding-bottom: 15px;">
      <h2 style="margin:0; font-size: 1.4rem;">Agenda synchronisatie</h2>
      <span id="agendaModalClose" style="cursor:pointer; font-size:28px; font-weight:bold; color:var(--muted); line-height: 1;">&times;</span>
    </div>

    <!-- Desktop variant -->
    <div id="agendaDesktop" style="display:none;">
      <div class="form">
      {% if calendar_active %}
        <div style="display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background: rgba(0,255,0,0.06); margin-bottom:12px;">
          <span aria-hidden="true" style="font-size:18px;">✅</span>
          <div style="color:var(--text);">
            <strong>Volgens ons systeem heb je je agenda-app al gesynchroniseerd.</strong>
            {% if calendar_last_synced %}
              <div style="color:var(--muted); font-size:0.92em; margin-top:2px;">
                Laatst gesynchroniseerd: {{ calendar_last_synced|date:"d-m-Y H:i" }}
              </div>
            {% endif %}
          </div>
        </div>

        <p style="margin-top:0; color:var(--muted);">
          Wil je opnieuw synchroniseren of de link opnieuw toevoegen? Gebruik de link hieronder.
        </p>
      {% else %}
        <p style="margin-top:0; color:var(--muted);">
          Wil je de Apotheek Jansen Agenda synchroniseren met jouw agenda app? Open de Jansen app op je telefoon en klik op de synchroniseer knop. Of kopieer de link hieronder en open die op je telefoon.
          Als je hem één keer toevoegt, worden wijzigingen automatisch bijgewerkt.
        </p>
      {% endif %}

      <label class="section-label">Jouw agenda-link</label>
        <div style="display:flex; gap:10px;">
          <input id="webcalInput" class="admin-input" type="text" readonly value="{{ webcal_url }}" style="flex:1;">
          <button
            type="button"
            id="copyWebcalBtn"
            class="btn"
            style="height:54px; display:inline-flex; align-items:center;"
          >
            Kopieer
          </button>
        </div>

      <div style="margin-top:14px; padding-top:16px; border-top: 1px solid var(--border);">
        <small style="color:var(--muted); display:block; line-height:1.5;">
          <strong>Zo voeg je hem toe op je telefoon:</strong><br>
          1) Open de Jansen app op je telefoon, navigeer naar dit tabblad en klik op de synchroniseer knop of kopieer de agenda-link hierboven en stuur de link naar jezelf (WhatsApp of e-mail) en open hem op je telefoon of typ hem over in je browser.<br>
          2) Kies in je agenda-app voor <em>Abonneren</em> / <em>Kalender toevoegen</em> en bevestig.
        </small>
      </div>

      <div style="margin-top:14px;">
        <small style="color:var(--muted); display:block; line-height:1.5;">
          <strong>Lukt openen niet?</strong><br>
          Open je agenda-app en open <em>Instellingen</em>. Klik op <em>Kalender toevoegen</em> (of <em>Abonneren</em>) en plak daar de link.
        </small>
      </div>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:18px;">
        <button type="button" id="agendaModalOkDesktop" class="btn btn-danger">Sluiten</button>
      </div>
    </div>
    </div>

    <!-- Mobile variant -->
    <div id="agendaMobile" style="display:none;">
      <div class="form">
      {% if calendar_active %}
        <div style="display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background: rgba(0,255,0,0.06); margin-bottom:12px;">
          <span aria-hidden="true" style="font-size:18px;">✅</span>
          <div>
            <strong>Volgens ons systeem heb je je agenda-app al gesynchroniseerd.</strong>
            {% if calendar_last_synced %}
              <div style="color:var(--muted); font-size:0.92em; margin-top:2px;">
                Laatst gesynchroniseerd: {{ calendar_last_synced|date:"d-m-Y H:i" }}
              </div>
            {% endif %}
          </div>
        </div>

        <p style="margin-top:0; color:var(--muted);">
          Wil je opnieuw synchroniseren? Open de agenda-app of kopieer de link.
        </p>
      {% else %}
        <p style="margin-top:0; color:var(--muted);">
          Synchroniseer de Apotheek Jansen Agenda met jouw agenda app. Daarna worden wijzigingen automatisch bijgewerkt.
        </p>
      {% endif %}

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
        <button type="button" id="openAgendaBtn" class="btn btn-save">
          {% if calendar_active %}Opnieuw synchroniseren{% else %}Open agenda-app{% endif %}
        </button>
        <button type="button" id="copyWebcalBtnMobile" class="btn">Kopieer link</button>
      </div>

      <div style="margin-top:18px; padding-top:16px; border-top: 1px solid var(--border);">
        <small style="color:var(--muted); display:block; line-height:1.5;">
          <strong>Werkt de “Open agenda-app” knop niet?</strong><br>
          1) Tik op <em>Kopieer link</em>.<br>
          2) Open je agenda-app en ga naar <em>Instellingen</em>.<br>
          3) Kies <em>Kalender toevoegen</em> of <em>Abonneren</em>.<br>
          4) Plak de link en sla op.
        </small>
      </div>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:16px;">
        <button type="button" id="agendaModalOkMobile" class="btn btn-danger">Sluiten</button>
      </div>
    </div>
    </div>

  </div>
</div>
{% endblock %}