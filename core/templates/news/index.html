{# templates/news/index.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Nieuws{% endblock %}
{% block header_title %}Nieuws{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/agenda/agenda.css' %}">
  <link rel="stylesheet" href="{% static 'css/news/news.css' %}">
  <script src="{% static 'js/news/news.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="card birthdays-card">

  <div class="agenda-section">
    <div class="birthday-header agenda-section-header">
    <span
      class="birthday-icon icon-badge i-amber"
      style="--icon: url('{% static 'img/lucide/nieuws-lucide.svg' %}');"
      aria-hidden="true">
    </span>
      <div class="birthday-header-text">
        <h2>Nieuws</h2>
        <p>Klik op de items om te openen.</p>
      </div>

      {% if can_edit %}
        <button
          type="button"
          class="btn btn-save js-toggle-form"
          data-target="#news-form"
          aria-expanded="false"
          aria-controls="news-form"
          title="Nieuwsbericht toevoegen"
        >
          Toevoegen
        </button>
      {% endif %}
    </div>

    {% if can_edit %}
      <form
        id="news-form"
        class="form agenda-inline-form {% if not form.errors %}is-hidden{% endif %}"
        method="post"
        enctype="multipart/form-data"
        autocomplete="off"
        data-lock-submit="1"
      >
        {% csrf_token %}
        <input type="hidden" name="add_news" value="1">
        {{ form.non_field_errors }}

        <label for="{{ form.title.id_for_label }}">Titel (max 50 karakters):</label>
        {{ form.title.errors }}
        {{ form.title }}

        <label for="{{ form.short_description.id_for_label }}">Korte beschrijving (max 100 karakters):</label>
        {{ form.short_description.errors }}
        {{ form.short_description }}

        <label for="{{ form.description.id_for_label }}">Beschrijving:</label>
        {{ form.description.errors }}
        {{ form.description }}

        <label for="{{ form.file.id_for_label }}">Bestand:</label>
        {{ form.file.errors }}
        <div class="news-file-wrapper">
          {{ form.file }}
          <label for="{{ form.file.id_for_label }}" class="btn">
            Bestand kiezen
          </label>
          <span class="news-file-name" data-file-name></span>
        </div>

        <p class="small-text" style="margin-top:4px;">
          <em>Optioneel: selecteer een PDF of afbeelding (PNG, JPEG of JPG) met een maximale bestandsgrootte van 25 MB. Nieuws wordt automatisch verwijderd na 6 maanden.</em>
        </p>

        <div class="actions-wrap horizontal" style="margin-top:12px; display:flex; justify-content:space-between; gap:16px;">
          <button
            type="button"
            class="btn btn-danger js-cancel-form"
            data-target="#news-form"
          >
            Annuleren
          </button>

          <button type="submit" class="btn btn-save" data-submit-btn>
            Opslaan
          </button>
        </div>
      </form>
    {% endif %}

    {% if news_items %}
      <ul class="birthday-list agenda-list news-list">
        {% for item, edit_form in news_rows %}
          <li
            class="birthday-item news-item"
            data-news-item="{{ item.id }}"
            data-has-file="{% if item.has_file %}1{% else %}0{% endif %}"
          >
            <div class="agenda-item-row">
              <div class="birthday-main">
                <div class="birthday-left">
                  <span class="birthday-name">{{ item.title }}</span>
                  {% if item.short_description %}
                    <div class="birthday-meta">
                      <span class="agenda-description">
                        {{ item.short_description }}
                      </span>
                    </div>
                  {% endif %}
                </div>
                <div class="birthday-right">
                  <span class="birthday-date">
                    {{ item.date|date:"d-m-Y" }}
                  </span>
                </div>
              </div>

              {% if can_edit %}
                <div class="agenda-actions" data-stop-toggle>
                  <button
                    type="button"
                    class="icon-btn js-toggle-form"
                    data-target="#news-edit-{{ item.id }}"
                    aria-expanded="{% if open_edit_id == item.id %}true{% else %}false{% endif %}"
                    aria-controls="news-edit-{{ item.id }}"
                    title="Bewerken"
                    aria-label="Bewerken"
                  >
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                         stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 20h9"/>
                      <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                    </svg>
                  </button>

                  <form method="post" class="agenda-delete-form news-delete-form" data-stop-toggle>
                    {% csrf_token %}
                    <button
                      type="submit"
                      name="delete_item"
                      value="{{ item.id }}"
                      class="icon-btn danger"
                      title="Verwijderen"
                      aria-label="Verwijderen"
                    >
                      <svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                           stroke="currentColor" stroke-width="2"
                           stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                      </svg>
                    </button>
                  </form>
                </div>
              {% endif %}
            </div>

            {% if can_edit %}
              <form
                id="news-edit-{{ item.id }}"
                class="form agenda-inline-form news-edit-form {% if open_edit_id != item.id and not edit_form.errors %}is-hidden{% endif %}"
                method="post"
                enctype="multipart/form-data"
                autocomplete="off"
                data-stop-toggle
                data-lock-submit="1"
              >
                {% csrf_token %}
                <input type="hidden" name="edit_item" value="{{ item.id }}">
                {{ edit_form.non_field_errors }}

                <label for="{{ edit_form.title.id_for_label }}">Titel (max 50 karakters):</label>
                {{ edit_form.title.errors }}
                {{ edit_form.title }}

                <label for="{{ edit_form.short_description.id_for_label }}">Korte beschrijving (max 100 karakters):</label>
                {{ edit_form.short_description.errors }}
                {{ edit_form.short_description }}

                <label for="{{ edit_form.description.id_for_label }}">Beschrijving:</label>
                {{ edit_form.description.errors }}
                {{ edit_form.description }}

                <label for="{{ edit_form.file.id_for_label }}">Bestand:</label>
                {{ edit_form.file.errors }}
                <div class="news-file-wrapper">
                  {{ edit_form.file }}
                  <label for="{{ edit_form.file.id_for_label }}" class="btn">
                    Bestand kiezen
                  </label>
                  <span class="news-file-name" data-file-name></span>

                  <span class="news-current-file">
                    Huidig bestand:
                    {% if item.original_filename %}
                      {{ item.original_filename }}
                    {% else %}
                      -
                    {% endif %}
                  </span>
                </div>

                <p class="small-text" style="margin-top:4px;">
                  <em>Optioneel: selecteer een nieuw bestand om het huidige te vervangen. Kies een PDF of afbeelding (PNG, JPEG of JPG) met een maximale bestandsgrootte van 25 MB. Nieuws wordt automatisch verwijderd na 6 maanden.</em>
                </p>

                <div class="actions-wrap horizontal" style="margin-top:12px; display:flex; justify-content:space-between; gap:16px;">
                  <button
                    type="button"
                    class="btn btn-danger js-cancel-form"
                    data-target="#news-edit-{{ item.id }}"
                  >
                    Annuleren
                  </button>

                  <button type="submit" class="btn btn-save" data-submit-btn>
                    Opslaan
                  </button>
                </div>
              </form>
            {% endif %}

            <div
              id="news-body-{{ item.id }}"
              class="news-body is-hidden"
              data-stop-toggle
            >
              {% if item.description %}
                <div class="news-description">
                  {{ item.description|linebreaks }}
                </div>
              {% endif %}

              {% if item.has_file %}
                <div
                  class="news-media"
                  data-media-host
                  data-item-id="{{ item.id }}"
                  data-loaded="0"
                ></div>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="birthday-empty">
        Nog geen nieuwsberichten.
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}