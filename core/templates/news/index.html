{# templates/news/index.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Nieuws{% endblock %}
{% block header_title %}Nieuws{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/agenda/agenda.css' %}">
  <link rel="stylesheet" href="{% static 'css/news/news.css' %}">
  <script src="{% static 'js/news/news.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="card birthdays-card">

  <div class="agenda-section">
    <div class="birthday-header agenda-section-header">
      <img
        src="{% static 'img/nieuws-256x256.png' %}"
        alt="Nieuws"
        class="birthday-icon"
      >
      <div class="birthday-header-text">
        <h2>Nieuws</h2>
        <p>Klik op de items om te openen.</p>
      </div>
      {% if perms.core.can_upload_news %}
        <button
          type="button"
          class="btn agenda-plus-btn js-toggle-form"
          data-target="#news-form"
          aria-expanded="false"
          aria-controls="news-form"
          title="Nieuwsbericht toevoegen"
        >
          +
        </button>
      {% endif %}
    </div>

    {% if perms.core.can_upload_news %}
      <form
        id="news-form"
        class="form agenda-inline-form {% if not form.errors %}is-hidden{% endif %}"
        method="post"
        enctype="multipart/form-data"
      >
        {% csrf_token %}
        {{ form.non_field_errors }}

        {{ form.title.errors }}
        {{ form.title }}

        {{ form.short_description.errors }}
        {{ form.short_description }}

        {{ form.description.errors }}
        {{ form.description }}

        {{ form.file.errors }}
        <div class="news-file-wrapper">
          {{ form.file }}
          <label for="{{ form.file.id_for_label }}" class="btn">
            Bestand kiezen
          </label>
          <span class="news-file-name" id="news-file-name"></span>
        </div>

        <p class="small-text" style="margin-top:4px;">
          <em>Optioneel: selecteer een PDF of afbeelding (PNG, JPEG of JPG) met een maximale bestandsgrootte van 25 MB. Nieuws wordt automatisch verwijderd na 6 maanden.</em>
        </p>

        <button type="submit" class="btn">
          Opslaan
        </button>

      </form>
    {% endif %}

    {% if news_items %}
      <ul class="birthday-list agenda-list news-list">
        {% for item in news_items %}
          <li class="birthday-item news-item">
            {% if perms.core.can_upload_news %}
              <form method="post" class="agenda-delete-form news-delete-form">
                {% csrf_token %}
                <button
                  type="submit"
                  name="delete_item"
                  value="{{ item.id }}"
                  class="btn btn-danger agenda-delete-btn"
                  title="Verwijderen"
                  aria-label="Verwijderen"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </form>
            {% endif %}

            {# header (altijd zichtbaar): titel + datum #}
            <div class="birthday-main">
              <div class="birthday-left">
                <span class="birthday-name">{{ item.title }}</span>
                {% if item.short_description %}
                  <div class="birthday-meta">
                    <span class="agenda-description agenda-description--single-line">
                      {{ item.short_description }}
                    </span>
                  </div>
                {% endif %}
              </div>
              <div class="birthday-right">
                <span class="birthday-date">
                  {{ item.date|date:"d-m-Y" }}
                </span>
              </div>
            </div>

            {# body (inklapbaar): volledige tekst + media #}
            <div
              id="news-body-{{ item.id }}"
              class="news-body is-hidden"
            >
              {% if item.description %}
                <div class="news-description">
                  {{ item.description|linebreaks }}
                </div>
              {% endif %}

              {% if item.has_file %}
                <div class="news-media">
                  {% if item.is_pdf %}
                    {% for url in item.page_urls %}
                      <img src="{{ url }}" alt="Nieuws PDF pagina">
                    {% endfor %}
                  {% else %}
                    <img src="{{ item.file_url }}" alt="Nieuws afbeelding">
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="birthday-empty">
        Nog geen nieuwsberichten.
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}