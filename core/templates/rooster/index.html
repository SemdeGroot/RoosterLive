{% extends "base.html" %}
{% load static i18n %}

{% block title %}Rooster{% endblock %}
{% block header_title %}Rooster{% endblock %}

{% block head %}
  {# Hergebruik de weekpicker/daterange styles uit beschikbaarheid #}
  <link rel="stylesheet" href="{% static 'css/mijnbeschikbaarheid/mijnbeschikbaarheid.css' %}">
  {# En je bestaande rooster styles voor uploader + pages #}
  <link rel="stylesheet" href="{% static 'css/rooster/rooster.css' %}">
{% endblock %}

{% block content %}
<div id="roosterRoot" class="card" style="padding:16px;">

  <!-- Weeknavigatie (identiek aan mijnbeschikbaarheid) -->
  <div class="week-controls">
    <button type="button" id="prevWeekBtn"
            class="btn btn-icon"
            {% if not has_prev %}disabled aria-disabled="true"{% endif %}
            data-target="{{ prev_monday|date:'Y-m-d' }}"
            aria-label="Vorige week" data-haptic>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
           viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
    </button>

    <div class="week-picker">
      <button data-haptic type="button" id="weekPickerBtn"
              class="btn week-picker-btn"
              aria-haspopup="listbox"
              aria-expanded="false"
              aria-controls="weekMenu">
        <span class="wp-label">{{ header_title }}</span>
        <span class="wp-caret" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
              viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </span>
      </button>

      <div id="weekMenu" class="week-menu" role="listbox" tabindex="-1" hidden>
        {% for opt in week_options %}
          <div role="option"
               class="week-option{% if opt.value == monday|date:'Y-m-d' %} is-active{% endif %}"
               data-value="{{ opt.value }}"
               aria-selected="{% if opt.value == monday|date:'Y-m-d' %}true{% else %}false{% endif %}">
            <strong>Week {{ opt.iso_week }} – {{ opt.iso_year }}</strong>
            <small>({{ opt.start|date:"d-m" }} – {{ opt.end|date:"d-m" }})</small>
          </div>
        {% endfor %}
      </div>
    </div>

    <button data-haptic type="button" id="nextWeekBtn"
            class="btn btn-icon"
            {% if not has_next %}disabled aria-disabled="true"{% endif %}
            data-target="{{ next_monday|date:'Y-m-d' }}"
            aria-label="Volgende week">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
           viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
    </button>
  </div>

  <!-- Daterange (identiek aan mijnbeschikbaarheid) -->
  <div class="availability-daterange" style="margin-bottom: 12px;">
    {{ monday|date:"d-m-Y" }} – {{ week_end|date:"d-m-Y" }}
  </div>

  {% if can_upload %}
    <form method="post" enctype="multipart/form-data" class="uploader" id="rosterForm">
      {% csrf_token %}
      {# Hidden — doelweek voor uploaden #}
      <input type="hidden" name="monday" id="mondayField" value="{{ monday|date:'Y-m-d' }}">
      <input type="file" id="rosterFile" name="file" accept="application/pdf" hidden required>

      <div class="dropzone" id="dropzone" onclick="document.getElementById('rosterFile').click()">
        <div class="dz-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6"/>
            <path d="M12 12v6"/>
            <path d="M9 15h6"/>
          </svg>
        </div>
        <div class="dz-text">
          <div class="dz-title">Sleep je PDF van het rooster hierheen of klik om te kiezen.</div>
          <div class="dz-hint">Alleen .pdf — Het nieuwe rooster vervangt automatisch het oude voor de geselecteerde week <strong>zodra je op Uploaden klikt</strong>.</div>
        </div>
      </div>

      <div class="file-meta" id="fileMeta" style="display:none;">
        Geselecteerd: <span class="file-name" id="fileName"></span>
      </div>

      <div class="u-actions">
        <button class="btn" type="submit" id="uploadBtn" disabled data-haptic>Uploaden</button>
        <button type="button" class="btn" id="clearBtn" style="display:none;" data-haptic>Wissen</button>
      </div>
    </form>
  {% endif %}

  {% if no_roster %}
    <p style="color:var(--muted); margin-top:6px;">Nog geen rooster geüpload voor deze week.</p>
  {% else %}
    <div class="pages">
      {% for url in page_urls %}
        <div class="page">
          <img src="{{ url }}" alt="Pagina {{ forloop.counter }}">
        </div>
      {% endfor %}
    </div>
  {% endif %}

</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/rooster/rooster.js' %}" defer></script>
{% endblock %}