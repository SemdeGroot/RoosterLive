{% extends "base.html" %}
{% block title %}Rooster{% endblock %}
{% block header_title %}Rooster{% endblock %}

{% block content %}
<style>
  /* --- Uploader styles --- */
  .uploader { margin-bottom: 14px; }
  .dropzone {
    display:flex; align-items:center; gap:12px;
    padding:14px 16px;
    background:var(--panel-2);
    border:1px dashed var(--border);
    border-radius:12px;
    cursor:pointer;
    transition:border-color .15s, box-shadow .15s;
  }
  .dropzone:hover,
  .dropzone.is-dragover { border-color:#204887; box-shadow:0 0 0 2px rgba(31,75,160,.20) inset; }
  .dz-icon {
    flex:0 0 auto;
    width:36px; height:36px; border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    background:#13223f; color:#cfe0ff; border:1px solid #223355;
  }
  .dz-text { display:flex; flex-direction:column; gap:4px; }
  .dz-title { color:var(--text); font-weight:600; line-height:1.1; }
  .dz-hint { color:var(--muted); font-size:.95em; }
  .file-meta { margin-top:8px; color:var(--muted); }
  .file-name { color:var(--text); font-weight:600; }

  .u-actions { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
  .btn.ghost { background:#17212b; } /* subtiele 2e knop */

  /* Pagina-grid */
  .pages { display:grid; gap:12px; }
  .page { border:1px solid var(--border); border-radius:12px; background:#0a0f14; overflow:hidden; }
  .page img { display:block; width:100%; height:auto; }
</style>

<div class="card" style="padding:16px;">
  {% if perms.core.can_upload_roster %}
    <form method="post" enctype="multipart/form-data" class="uploader" id="rosterForm">
      {% csrf_token %}
      <input type="file" id="rosterFile" name="file" accept="application/pdf" hidden required>

      <div class="dropzone" id="dropzone" onclick="document.getElementById('rosterFile').click()">
        <div class="dz-icon" aria-hidden="true">
          <!-- klein PDF/Upload icoon in blauw -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6"/>
            <path d="M12 12v6"/>
            <path d="M9 15h6"/>
          </svg>
        </div>
        <div class="dz-text">
          <div class="dz-title">Sleep je PDF van het rooster hierheen of klik om te kiezen.</div>
          <div class="dz-hint">Alleen .pdf - Het nieuwe rooster vervangt automatisch het oude <strong>zodra je op Uploaden klikt.</strong></div>
        </div>
      </div>

      <div class="file-meta" id="fileMeta" style="display:none;">
        Geselecteerd: <span class="file-name" id="fileName"></span>
      </div>

      <div class="u-actions">
        <button class="btn" type="submit" id="uploadBtn" disabled>Uploaden</button>
        <button type="button" class="btn ghost" id="clearBtn" style="display:none;">Wissen</button>
      </div>
    </form>
  {% endif %}

  {% if no_roster %}
    <p style="color:var(--muted); margin-top:6px;">Nog geen rooster ge√ºpload.</p>
  {% else %}
    <div class="pages">
      {% for url in page_urls %}
        <div class="page">
          <img src="{{ url }}" alt="Pagina {{ forloop.counter }}">
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

<script>
  (function(){
    const dz = document.getElementById('dropzone');
    const input = document.getElementById('rosterFile');
    const meta = document.getElementById('fileMeta');
    const nameSpan = document.getElementById('fileName');
    const uploadBtn = document.getElementById('uploadBtn');
    const clearBtn = document.getElementById('clearBtn');

    function setFile(file){
      if(!file) return;
      if(file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')){
        alert('Kies een PDF-bestand (.pdf).');
        return;
      }
      // Zet in input
      const dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;

      // UI
      nameSpan.textContent = file.name;
      meta.style.display = '';
      uploadBtn.disabled = false;
      clearBtn.style.display = '';
    }

    // Klikken op input
    input.addEventListener('change', () => {
      setFile(input.files[0]);
    });

    // Drag & drop
    ['dragenter','dragover'].forEach(ev => dz.addEventListener(ev, e => {
      e.preventDefault(); e.stopPropagation(); dz.classList.add('is-dragover');
    }));
    ['dragleave','drop'].forEach(ev => dz.addEventListener(ev, e => {
      e.preventDefault(); e.stopPropagation(); dz.classList.remove('is-dragover');
    }));
    dz.addEventListener('drop', e => {
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) setFile(f);
    });

    clearBtn.addEventListener('click', () => {
      input.value = '';
      nameSpan.textContent = '';
      meta.style.display = 'none';
      uploadBtn.disabled = true;
      clearBtn.style.display = 'none';
    });
  })();
</script>
{% endblock %}