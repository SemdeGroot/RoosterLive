<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Offline</title>
  <style>
    :root {
    --bg:        #0d131b;
    --panel:     #131a24;   
    --muted:     #9fb2c8;
    --accent:    #072a72; 
}
    body {
      margin: 0;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #0b0f14;
      color: #ccd6e0;
      text-align: center;
    }
    .card {
      max-width: 360px;
      margin: 0 auto;
      padding: 24px;
      background: #161d25;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    .app-icon {
      width: 72px;
      height: 72px;
      margin: 0 auto 12px;
      border-radius: 16px;
      display: block;
    }
    h1 {
      margin-top: 0;
      color: #ccd6e0;
      font-size: 20px;
      font-weight: 600;
    }
    p {
      font-size: 14px;
      line-height: 1.5;
      margin: 12px 0;
      color: #9fb2c8;
    }
    .small {
      opacity: .7;
      font-size: 12px;
      margin-top: 18px;
      margin-bottom: 0px;
    }

/* Pull-to-refresh container */
#pull-to-refresh {
  --ptr-translate: 0px;
  --ptr-opacity: 0;

  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 64px;
  display: flex;
  align-items: flex-start;
  justify-content: center;

  /* Iets boven je titels blijven */
  padding-top: calc(env(safe-area-inset-top, 0px) + 2px);

  transform: translateY(calc(var(--ptr-translate) - 120%));
  opacity: var(--ptr-opacity);
  transition: transform 0.18s ease-out, opacity 0.18s ease-out;
  pointer-events: none;
  z-index: 1;
}

/* Cirkelhouder */
#pull-to-refresh .ptr-ring {
  width: 26px;
  height: 26px;
  position: relative;
}

/* Basis dot (donker / neutraal) */
#pull-to-refresh .ptr-dot {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 4px;
  height: 4px;
  margin-left: -2px;
  margin-top: -2px;
  border-radius: 50%;
  background: var(--muted);
  opacity: 0.25;
}

/* Puntjes op een perfecte cirkel (radius 10px) */
#pull-to-refresh .ptr-dot:nth-child(1)  { transform: rotate(0deg)   translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(2)  { transform: rotate(30deg)  translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(3)  { transform: rotate(60deg)  translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(4)  { transform: rotate(90deg)  translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(5)  { transform: rotate(120deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(6)  { transform: rotate(150deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(7)  { transform: rotate(180deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(8)  { transform: rotate(210deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(9)  { transform: rotate(240deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(10) { transform: rotate(270deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(11) { transform: rotate(300deg) translateY(-10px); }
#pull-to-refresh .ptr-dot:nth-child(12) { transform: rotate(330deg) translateY(-10px); }

/* Tijdens pull: gevulde (actieve) dots worden accentkleur */
#pull-to-refresh .ptr-dot.active {
  background: var(--accent);
  opacity: 1;
}

/* --------- REFRESH-STATE: WAVE + ROTERENDE CIRKEL --------- */

/* Tijdens refresh: ring draait als geheel */
#pull-to-refresh.refreshing .ptr-ring {
  animation: ptr-ring-rotate 1s linear infinite;
  transform-origin: 50% 50%;
}

/* Tijdens refresh: individuele dots krijgen wave-animatie */
#pull-to-refresh.refreshing .ptr-dot {
  background: rgba(0, 0, 0, 0.18);
  opacity: 0.15;
  animation: ptr-dot-chase 0.9s linear infinite;
}

/* Vertraging per dot → lopend licht rondom de cirkel */
#pull-to-refresh.refreshing .ptr-dot:nth-child(1)  { animation-delay: 0s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(2)  { animation-delay: 0.075s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(3)  { animation-delay: 0.15s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(4)  { animation-delay: 0.225s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(5)  { animation-delay: 0.3s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(6)  { animation-delay: 0.375s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(7)  { animation-delay: 0.45s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(8)  { animation-delay: 0.525s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(9)  { animation-delay: 0.6s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(10) { animation-delay: 0.675s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(11) { animation-delay: 0.75s; }
#pull-to-refresh.refreshing .ptr-dot:nth-child(12) { animation-delay: 0.825s; }

/* Wave: van donker → licht (accent) → weer terug */
@keyframes ptr-dot-chase {
  0%, 20% {
    opacity: 0.35;        
    background: var(--muted);
  }
  40%, 60% {
    opacity: 1;       
    background: var(--accent);
  }
  80%, 100% {
    opacity: 0.45;         
    background: var(--muted);
  }
}

/* Hele ring draait langzaam rond */
@keyframes ptr-ring-rotate {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

/* Alleen tijdens refresh — body-topvlak wordt identiek aan de header */
body.ptr-panel-bg {
  background:var(--panel) !important;

  /* Hoogte van de “header extension” */
  background-size: 40px !important;
}
  </style>
</head>
<body>
  <div id="pull-to-refresh">
  <div class="ptr-ring">
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
    <span class="ptr-dot"></span>
  </div>
</div>
  <div class="card">
    <img src="/static/img/app_icon_trans-512x512.png" alt="App icoon" class="app-icon">

    <h1>Je bent offline</h1>

    <p>Er is geen netwerkverbinding.<br>
    Probeer het opnieuw zodra je internet hebt.</p>

    <p class="small">Deze pagina verschijnt automatisch bij offline gebruik van de app.</p>
  </div>
  <script>// ---------- PULL TO REFRESH IN PWA STANDALONE ----------
(function () {
  const isStandalone =
    (window.matchMedia &&
      window.matchMedia('(display-mode: standalone)').matches) ||
    window.navigator.standalone === true;

  if (!isStandalone) {
    return; // alleen in geïnstalleerde PWA
  }

  const ptr = document.getElementById('pull-to-refresh');
  if (!ptr) return;

  const dots = Array.from(ptr.querySelectorAll('.ptr-dot'));
  const app = document.querySelector('.app');
  const body = document.body;

  let startY = 0;
  let pulling = false;
  let maxPull = 0;
  let wasArmed = false;

  const PULL_THRESHOLD = 220;   // hoeveel je moet pullen
  const MAX_VISUAL_PULL = 90;   // hoe ver de indicator visueel naar beneden komt
  const REFRESH_OFFSET = 90;    // zelfde positie aanhouden tijdens refresh

  // ============================
  //  SENTINEL: "bovenaan" detectie
  // ============================
  let sentinelVisible = true; // fallback: liever wél PTR aan de top als er iets misgaat

  (function setupSentinel() {
    const content = document.querySelector('main.content');
    if (!content) return; // fallback: dan doen we het zonder sentinel

    // klein onzichtbaar element bovenaan de content
    const sentinel = document.createElement('div');
    sentinel.setAttribute('data-ptr-sentinel', 'true');
    sentinel.style.position = 'relative';
    sentinel.style.width = '1px';
    sentinel.style.height = '1px';
    sentinel.style.margin = '0';
    sentinel.style.padding = '0';
    sentinel.style.opacity = '0';
    sentinel.style.pointerEvents = 'none';

    // als eerste kind van .content
    content.insertBefore(sentinel, content.firstChild);

    // observer die bijhoudt of de sentinel in beeld is
    const observer = new IntersectionObserver(
      (entries) => {
        const entry = entries[0];
        sentinelVisible = !!entry.isIntersecting && entry.intersectionRatio > 0;
      },
      {
        root: null,          // viewport
        threshold: 0.01      // zodra hij maar een beetje in beeld is
      }
    );

    observer.observe(sentinel);
  })();

  // Eén tikje haptic feedback (Android: vibrate, iOS: switch-hack)
  function hapticTick() {
    if (navigator.vibrate) {
      // Android / sommige browsers
      navigator.vibrate(40); // kort voelbaar tikje
      return;
    }

    // iOS fallback: onzichtbare switch togglen voor haptics
    const el = document.createElement('div');
    const id = 'haptic-' + Math.random().toString(36).slice(2);

    el.innerHTML =
      '<input type="checkbox" id="' + id + '" switch />' +
      '<label for="' + id + '"></label>';

    el.style.cssText =
      'position:fixed;left:-9999px;top:auto;width:1px;height:1px;' +
      'overflow:hidden;opacity:0;pointer-events:none;';

    document.body.appendChild(el);

    const label = el.querySelector('label');
    if (label) {
      label.click(); // triggert de haptic
    }

    setTimeout(() => {
      el.remove();
    }, 500);
  }

  function updateDotsByProgress(progress) {
    // progress: 0–1 → aantal actieve dots
    const count = Math.round(progress * dots.length);
    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i < count);
    });
  }

  function setProgress(dy) {
    const clamped = Math.max(0, dy);
    const visual = Math.min(clamped, MAX_VISUAL_PULL);
    const progress = Math.min(clamped / PULL_THRESHOLD, 1); // 0–1

    // verticale positie en zichtbaarheid
    ptr.style.setProperty('--ptr-translate', `${visual}px`);
    ptr.style.setProperty(
      '--ptr-opacity',
      Math.min(1, clamped / 40).toString()
    );

    // dots vullen per stap
    updateDotsByProgress(progress);

    // "tikje" als de drempel voor het eerst wordt gehaald
    if (progress >= 1 && !wasArmed) {
      wasArmed = true;
      hapticTick();
    }
    if (progress < 1) {
      wasArmed = false;
    }
  }

  function resetPTR() {
    pulling = false;
    maxPull = 0;
    wasArmed = false;
    ptr.classList.remove('refreshing');
    ptr.style.setProperty('--ptr-translate', '0px');
    ptr.style.setProperty('--ptr-opacity', '0');
    dots.forEach((dot) => dot.classList.remove('active'));

    if (app) {
      app.classList.remove('ptr-shift-down');
    }

    if (body) {              
      body.classList.remove('ptr-panel-bg');
    }
  }

  window.addEventListener(
    'touchstart',
    (e) => {
      if (e.touches.length !== 1) return;

      // Alleen starten als de sentinel (bovenkant content) in beeld is
      if (!sentinelVisible) return;

      startY = e.touches[0].clientY;
      pulling = true;
      maxPull = 0;
      wasArmed = false;

      // direct tonen zonder hapering
      ptr.style.transition = 'none';
      setProgress(0);
    },
    { passive: true }
  );

  window.addEventListener(
    'touchmove',
    (e) => {
      if (!pulling) return;

      const dy = e.touches[0].clientY - startY;
      if (dy <= 0) {
        ptr.style.transition =
          'transform 0.18s ease-out, opacity 0.18s ease-out';
        resetPTR();
        return;
      }

      maxPull = Math.max(maxPull, dy);
      setProgress(dy);
    },
    { passive: true }
  );

  window.addEventListener('touchend', () => {
    if (!pulling) return;

    ptr.style.transition = 'transform 0.18s ease-out, opacity 0.18s ease-out';

    if (maxPull >= PULL_THRESHOLD) {
      // Drempel gehaald → dots worden spinner
      ptr.classList.add('refreshing');
      ptr.style.setProperty('--ptr-translate', `${REFRESH_OFFSET}px`);
      ptr.style.setProperty('--ptr-opacity', '1');
      dots.forEach((dot) => dot.classList.remove('active'));

      // hele app (header + content) een beetje omlaag
      if (app) {
        app.classList.add('ptr-shift-down');
      }

      // body-top vlak in kleur var(--panel)
      if (body) {
        body.classList.add('ptr-panel-bg');
      }

      // kleine delay zodat spinner + shift zichtbaar zijn
      setTimeout(() => {
        window.location.reload();
      }, 2500); // tijd van animatie
    } else {
      resetPTR();
    }
  });
})();</script>
</body>
</html>